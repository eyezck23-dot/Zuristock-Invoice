<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Zuristock Login</title>
    <!-- Load Tailwind CSS for styling -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Custom font and base styles */
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;700;800&display=swap');
        body {
            font-family: 'Inter', sans-serif;
            background: linear-gradient(135deg, #0f172a 0%, #1e293b 100%); /* Dark, professional gradient */
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 1rem;
        }

        /* Custom style for the Admin Modal backdrop */
        .modal-backdrop {
            background-color: rgba(0, 0, 0, 0.7);
            backdrop-filter: blur(5px);
        }
        
        /* Custom styling for the Admin button */
        #admin-access-button {
            position: fixed;
            bottom: 1rem;
            right: 1rem;
            transition: all 0.3s ease;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.5);
            /* Use a distinct color for the Admin button */
            background-color: #f59e0b; /* Amber 500 */
            color: #1f2937; /* Dark text */
        }
        
        /* Style for the credential list table */
        #user-list-table th, #user-list-table td {
            padding: 0.5rem;
            border-bottom: 1px solid #475569; /* Slate 600 */
        }
        #user-list-table th {
            text-align: left;
            font-weight: 600;
        }
    </style>

    <!-- Local Database & Logic -->
    <script>
        // Constants
        const ADMIN_PASSWORD = "ZuristockAdmin";
        const SUCCESS_URL = "./Zuri Stock V 3.html";
        const ADMIN_USERNAME = "Admin";
        
        // Local Storage Keys
        const LOCAL_STORAGE_KEY_USERNAME = 'lastUsername';
        const LOCAL_STORAGE_KEY_REMEMBER = 'rememberUsername';
        
        // Static, uploadable local database of user credentials
        // NOTE: This array is your "database". To add users, you must manually edit this code file.
        const LOCAL_CREDENTIALS = [
            { username: ADMIN_USERNAME, password: ADMIN_PASSWORD, role: 'superadmin' },
            // New users added as requested: User1 through User5
            { username: 'User1', password: 'ZuristockUser1', role: 'user' },
            { username: 'User2', password: 'ZuristockUser2', role: 'user' },
            { username: 'User3', password: 'ZuristockUser3', role: 'user' },
            { username: 'User4', password: 'ZuristockUser4', role: 'user' },
            { username: 'User5', password: 'ZuristockUser5', role: 'user' },
        ];
        
        // Custom message box function instead of alert()
        function showMessage(message, type = 'info') {
            const messageBox = document.getElementById('message-box');
            messageBox.textContent = message;
            messageBox.classList.remove('hidden', 'bg-green-500', 'bg-red-500', 'bg-blue-500', 'opacity-0');
            
            let bgColor = 'bg-blue-500'; // Default is info
            if (type === 'success') bgColor = 'bg-green-500';
            if (type === 'error') bgColor = 'bg-red-500';
            
            messageBox.classList.add(bgColor);
            
            setTimeout(() => {
                messageBox.classList.add('opacity-0');
                setTimeout(() => messageBox.classList.add('hidden'), 500); // Hide after transition
            }, 5000);
            messageBox.classList.remove('opacity-0'); // Show it
        }

        // ==========================================================
        // LOCAL DATA FUNCTIONS (using static array and localStorage)
        // ==========================================================

        /**
         * Loads the last saved username from localStorage.
         */
        function loadLastUsername() {
            const rememberCheckbox = document.getElementById('remember-username');
            const usernameInput = document.getElementById('login-username');

            // Check if the "remember" box was checked previously
            const isRemembered = localStorage.getItem(LOCAL_STORAGE_KEY_REMEMBER) === 'true';
            rememberCheckbox.checked = isRemembered;
            
            if (isRemembered) {
                usernameInput.value = localStorage.getItem(LOCAL_STORAGE_KEY_USERNAME) || '';
            }
            
            // Enable UI elements immediately since there's no asynchronous init
            document.getElementById('login-form').classList.remove('opacity-50', 'pointer-events-none');
            document.getElementById('admin-access-button').disabled = false;
        }
        
        /**
         * Saves the username to localStorage based on the checkbox state.
         */
        function saveLastUsername(username) {
            const rememberCheckbox = document.getElementById('remember-username');
            // Store the state of the checkbox
            localStorage.setItem(LOCAL_STORAGE_KEY_REMEMBER, rememberCheckbox.checked);
            
            if (rememberCheckbox.checked) {
                localStorage.setItem(LOCAL_STORAGE_KEY_USERNAME, username);
            } else {
                localStorage.removeItem(LOCAL_STORAGE_KEY_USERNAME);
            }
        }

        /**
         * Attempts to find a user in the static LOCAL_CREDENTIALS array.
         */
        function checkLogin(username, password) {
            const user = LOCAL_CREDENTIALS.find(u => u.username === username);

            if (!user) {
                return null; // User not found
            }
            
            // INSECURE: plaintext password comparison (for demo only)
            if (user.password === password) {
                return user; // Login successful
            } else {
                return null; // Password mismatch
            }
        }
        
        /**
         * Fetches and displays the list of all user credentials from the static array.
         */
        function fetchUserList() {
            const userListBody = document.getElementById('user-list-body');
            
            let html = '';
            if (LOCAL_CREDENTIALS.length === 0) {
                html = '<tr><td colspan="3" class="text-center py-4 text-gray-400">No users found in the local database.</td></tr>';
            } else {
                LOCAL_CREDENTIALS.forEach(data => {
                    html += `
                        <tr>
                            <td class="truncate max-w-[100px] sm:max-w-none">${data.username}</td>
                            <td>${data.password}</td>
                            <td class="text-center"><span class="px-2 py-1 text-xs font-semibold rounded-full ${data.role === 'superadmin' ? 'bg-amber-600 text-white' : 'bg-blue-100 text-blue-800'}">${data.role}</span></td>
                        </tr>
                    `;
                });
            }
            userListBody.innerHTML = html;
        }

        // ==========================================================
        // UI & EVENT HANDLERS
        // ==========================================================

        document.addEventListener('DOMContentLoaded', () => {
            // Replaced initializeFirebase with direct load
            loadLastUsername();

            const loginForm = document.getElementById('login-form');
            const adminPasswordModal = document.getElementById('admin-password-modal');
            const credentialViewerModal = document.getElementById('credential-viewer-modal');
            const adminAccessButton = document.getElementById('admin-access-button');
            const adminPasswordForm = document.getElementById('admin-password-form');
            const closeViewerButton = document.getElementById('close-viewer-modal');
            
            // --- Login Form Submission Handler ---
            loginForm.addEventListener('submit', async (e) => {
                e.preventDefault();
                const usernameInput = document.getElementById('login-username').value.trim();
                const passwordInput = document.getElementById('login-password').value.trim();
                const loginButton = e.submitter;

                loginButton.disabled = true;
                loginButton.textContent = 'Logging in...';

                if (!usernameInput || !passwordInput) {
                    showMessage("Please enter both username and password.", 'error');
                    loginButton.disabled = false;
                    loginButton.textContent = 'Log In';
                    return;
                }
                
                const userData = checkLogin(usernameInput, passwordInput);

                if (userData) {
                    showMessage(`Welcome, ${userData.username}! Redirecting...`, 'success');
                    
                    saveLastUsername(userData.username);

                    setTimeout(() => {
                         window.location.href = `${SUCCESS_URL}?user=${userData.username}&role=${userData.role}`;
                    }, 1000);

                } else {
                    showMessage("Invalid username or password.", 'error');
                    loginButton.disabled = false;
                    loginButton.textContent = 'Log In';
                }
            });
            
            // --- Admin Credential Viewer Access Logic ---
            adminAccessButton.addEventListener('click', () => {
                adminPasswordModal.classList.remove('hidden');
                document.getElementById('admin-access-password').value = '';
                document.getElementById('admin-access-password').focus();
            });

            adminPasswordForm.addEventListener('submit', (e) => {
                e.preventDefault();
                const inputPassword = document.getElementById('admin-access-password').value.trim();
                
                if (inputPassword === ADMIN_PASSWORD) {
                    adminPasswordModal.classList.add('hidden');
                    credentialViewerModal.classList.remove('hidden');
                    fetchUserList();
                } else {
                    showMessage("Incorrect Admin Password.", 'error');
                    document.getElementById('admin-access-password').value = '';
                }
            });

            closeViewerButton.addEventListener('click', () => {
                credentialViewerModal.classList.add('hidden');
            });
            
            [adminPasswordModal, credentialViewerModal].forEach(modal => {
                modal.addEventListener('click', (e) => {
                    if (e.target === modal) {
                        modal.classList.add('hidden');
                    }
                });
            });

        });
    </script>
</head>
<body>

    <!-- Global Message Box (Top Center) -->
    <div id="message-box" class="fixed top-5 left-1/2 transform -translate-x-1/2 px-6 py-3 rounded-full text-white font-semibold shadow-2xl transition-opacity duration-300 opacity-0 hidden z-50">
        <!-- Message text goes here -->
    </div>
    
    <!-- Main Login Card -->
    <div class="w-full max-w-md bg-white p-8 md:p-10 rounded-xl shadow-2xl">
        <div class="text-center mb-8">
            <h1 class="text-4xl font-extrabold text-gray-800 tracking-wider">
                ZURISTOCK
            </h1>
            <p class="text-sm text-gray-500 mt-2">Sign in to your account</p>
        </div>

        <form id="login-form" class="space-y-6 opacity-50 pointer-events-none transition-opacity">
            <div>
                <label for="login-username" class="block text-sm font-medium text-gray-700 mb-1">Username</label>
                <input type="text" id="login-username" required placeholder="Enter your username" autocomplete="username" value=""
                       class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-blue-500 focus:border-blue-500 transition duration-150">
            </div>

            <div>
                <label for="login-password" class="block text-sm font-medium text-gray-700 mb-1">Password</label>
                <input type="password" id="login-password" required placeholder="Enter your password" autocomplete="current-password" value=""
                       class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-blue-500 focus:border-blue-500 transition duration-150">
            </div>
            
            <!-- Remember Me Checkbox -->
            <div class="flex items-center justify-between">
                <div class="flex items-center">
                    <input id="remember-username" type="checkbox" checked
                           class="h-4 w-4 text-blue-600 border-gray-300 rounded focus:ring-blue-500">
                    <label for="remember-username" class="ml-2 block text-sm text-gray-900">
                        Remember Username
                    </label>
                </div>
                <!-- Password saving is handled by the browser's native password manager due to autocomplete="current-password" -->
            </div>

            <button type="submit"
                    class="w-full flex justify-center py-3 px-4 border border-transparent rounded-lg shadow-md text-sm font-medium text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 transition duration-150 transform hover:scale-[1.01]">
                Log In
            </button>
        </form>
    </div>

    <!-- Admin Credential Viewer Access Button (Bottom Right Corner) -->
    <button id="admin-access-button" disabled
            class="px-4 py-2 bg-amber-500 text-gray-800 text-sm font-medium rounded-lg hover:bg-amber-600 transition duration-150 disabled:opacity-50 disabled:cursor-not-allowed">
        Admin Credential Viewer
    </button>


    <!-- 1. Admin Password Prompt Modal (Hidden by Default) -->
    <div id="admin-password-modal" class="hidden fixed inset-0 z-40 flex items-center justify-center modal-backdrop">
        <div class="bg-white p-6 rounded-xl shadow-2xl w-full max-w-sm m-4">
            <h2 class="text-xl font-bold text-gray-800 mb-4">Admin Access Required</h2>
            <p class="text-sm text-gray-600 mb-4">Enter the Super Admin Password to access the viewer.</p>
            
            <form id="admin-password-form" class="space-y-4">
                <div>
                    <label for="admin-access-password" class="sr-only">Admin Password</label>
                    <input type="password" id="admin-access-password" required placeholder="Super Admin Password"
                           class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-amber-500 focus:border-amber-500">
                </div>

                <button type="submit"
                        class="w-full py-2 px-4 rounded-lg shadow-md text-sm font-medium text-white bg-amber-500 hover:bg-amber-600 transition duration-150">
                    Authenticate
                </button>
            </form>
        </div>
    </div>


    <!-- 2. Admin Credential Viewer Modal (Hidden by Default) -->
    <div id="credential-viewer-modal" class="hidden fixed inset-0 z-40 flex items-center justify-center modal-backdrop">
        <div class="bg-gray-800 p-6 md:p-8 rounded-xl shadow-2xl w-full max-w-4xl m-4 border border-amber-500 h-5/6 overflow-auto">
            
            <div class="flex justify-between items-start mb-6 sticky top-0 bg-gray-800 z-10 py-2">
                <div>
                    <h2 class="text-2xl font-bold text-white">Credential Viewer (Local Data)</h2>
                    <p class="text-sm text-yellow-300 mt-1">This list reflects the static user array in the HTML file's code.</p>
                </div>
                <button id="close-viewer-modal" class="text-gray-400 hover:text-white transition">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg>
                </button>
            </div>
            
            <!-- User List Table -->
            <div class="mb-8 max-h-[300px] overflow-y-auto border border-gray-700 rounded-lg">
                <table id="user-list-table" class="min-w-full text-sm text-gray-300">
                    <thead>
                        <tr class="bg-gray-700 sticky top-0">
                            <th>Username</th>
                            <th>Password</th>
                            <th class="text-center">Role</th>
                        </tr>
                    </thead>
                    <tbody id="user-list-body">
                        <!-- User data will be injected here -->
                        <tr><td colspan="3" class="text-center py-4 text-gray-500">Authenticate to load user list.</td></tr>
                    </tbody>
                </table>
            </div>

            <!-- Add New User Form (Replaced with explanation) -->
            <div class="border-t border-gray-700 pt-6">
                <h3 class="text-xl font-semibold text-white mb-4">Add New User</h3>
                <div class="p-4 bg-gray-900 border border-red-500 rounded-lg">
                    <p class="text-red-400 font-medium">Add User Disabled:</p>
                    <p class="text-sm text-gray-400 mt-1">
                        Since you requested a local, uploadable database (using a static array in the code), 
                        the application cannot save new users at runtime. To add a user, you must manually 
                        edit the `LOCAL_CREDENTIALS` array in the `login.html` file.
                    </p>
                </div>
            </div>
            
        </div>
    </div>

</body>
</html>
